@model Negotiation.Models.NegotiationViewModel
@{
    ViewBag.Title = "Negotiation";
    Layout = null;
}

<div style="width:100%; display:table">
    <div style="display:table-row">
        <div id="yourScoreTable" style="display:table-cell; width:300px; visibility:collapse; border-style:dashed; border-color:gray">
            @Html.Partial("NegotiationSideView", new List<Negotiation.Models.NegotiationSideDescription>() { Model.Domain.OwnerVariantDict[Model.HumanConfig.Side][Model.HumanConfig.Variant] })
        </div>
        <div id="partnerScoreTable" style="display:table-cell; width:400px; visibility:collapse; border-style:dashed; border-color:gray">
            @Html.Partial("NegotiationSideView", Model.Domain.OwnerVariantDict[Model.AiSide].Values)
        </div>
        <div style="display:table-cell">
            <div style="border-style:solid; border-color:purple">
                <table>
                    <tr>
                        <td>
                            Your role: @Model.HumanConfig.Side
                        </td>
                        <td>
                            Remaining Time: @Model.RemainingTime
                        </td>
                        <td>
                            <button onclick="toggleTableId('#yourscoretable')">
                                Your scores
                            </button>
                        </td>
                        <td>
                            <button onclick="toggleTableId('#partnerScoreTable')">
                                Partner's scores
                            </button>
                        </td>
                    </tr>
                </table>
            </div>
            <div style="border-style:solid; border-color:blue">
                Use the menuts below to select your offer <br />
                <ul>
                    <li>
                        You play the role of the <b>@Model.HumanConfig.Side</b>.
                    </li>
                    <li>
                        The negotiation relates to several <b>issues</b>. For each issue, there are several possible <b>values</b>.
                    </li>
                    <li>
                        Your score depends on the <b>values</b> in the final agreement, and on <b>time</b>. Click "Your scores" for details.
                    </li>
                    <li>
                        Use the menus below as a draft. Your partner cannot see them - you communicate with the buttons below ("send offer", "accept", and "reject").
                    </li>
                    <li>
                        To sign on an agreement, you MUST click the same values as your partner. <b>As you click on the same one, it turns green</b>. (Note that "Sign the agreement" is greyed out).
                    </li>
                    <li>
                        This draft is <b>not binding</b> until both of you sign it.
                    </li>
                </ul>
                <table>
                    <tr>
                        <td>
                            <b>Issue:</b>
                        </td>
                        <td>
                            <b>Options:</b>
                        </td>
                    </tr>
                    @foreach (var topic in Model.Domain.OwnerVariantDict[Model.HumanConfig.Side][Model.HumanConfig.Variant].Topics)
                    {
                        <tr>
                            <td>
                                @topic.Key + ":"
                            </td>
                            <td>
                                @Html.DropDownListFor(m => m.Offer.Offers[topic.Key], topic.Value.Options.Values.Select(x => new SelectListItem { Text = x.Name, Value = x.Name }))
                            </td>
                        </tr>
                    }
                    <tr>
                        <td>
                            Your score:
                        </td>
                        <td>
                            @(Model.Offer.Offers.Values.Sum(x => int.Parse(x.TopicValue)) + (((int)(Model.Domain.RoundLength.TotalSeconds * Model.Domain.NumberOfRounds - Model.RemainingTime.TotalSeconds)) / (int)Model.Domain.RoundLength.TotalSeconds) * Model.Domain.OwnerVariantDict[Model.HumanConfig.Side][Model.HumanConfig.Variant].TimeEffect)
                        </td>
                    </tr>
                </table>
                <button>Send Offer</button> or reply to recent partner's offer: <button>Accept</button>  <button>Reject</button><br />
                <button>Sign the agreement</button>
            </div>
            <div style="border-style:solid; border-color:turquoise">
                <h2>History of actions</h2>
                <table>
                    <tr>
                        <th>
                            Proposer
                        </th>
                        <th>
                            Action
                        </th>
                        <th>
                            Value
                        </th>
                    </tr>
                    @foreach (var action in Model.Actions)
                    {
                        <tr>
                            <td>
                                @action.Role
                            </td>
                            <td>
                                @action.Type
                            </td>
                            <td>
                                @action.Value
                            </td>
                        </tr>
                    }
                </table>
            </div>
            <div style="border-style:solid; border-color:black">
                <b>Click here to quit the negotiation immediately: <button>Opt Out</button></b>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    toggleTableId = function (tableId) {
        if ($(tableId).visible == "collapsed") {
            $(tableId).visible = "visible";
        }
        else {
            $(tableId).visible = "collapsed";
        }
    };
</script>




